{"ast":null,"code":"const initialState = {\n  books: [],\n  loading: true,\n  error: null,\n  cartItems: [],\n  orderTotal: 0,\n  cartItemsTotal: 0\n};\n\nconst updateCartItems = (cartItems, item, index) => {\n  if (index === -1) {\n    return [...cartItems, item];\n  }\n\n  return [...cartItems.slice(0, index), item, ...cartItems.slice(++index)];\n};\n\nconst updateCartItem = (book, item = {}) => {\n  const {\n    id = book.id,\n    name = book.name,\n    count = 0,\n    total = 0\n  } = item;\n  return {\n    id,\n    name,\n    count: count + 1,\n    total: book.price + total\n  };\n};\n\nconst updateOrderTotal = cartItems => {\n  console.log(cartItems);\n  if (Array.isArray(cartItems)) return cartItems.reduce((acc, el) => acc + el.total, 0);\n  return 1;\n};\n\nconst updateCartItemsTotal = cartItems => {\n  return cartItems.reduce((acc, el) => acc + el.count, 0);\n};\n\nexport const reducer = (state = initialState, action) => {\n  switch (action.type) {\n    case 'FETCH_BOOKS_SUCCESS':\n      return { ...state,\n        books: action.payload,\n        loading: false,\n        error: null\n      };\n\n    case 'FETCH_BOOKS_REQUEST':\n      return { ...state,\n        books: [],\n        loading: true,\n        error: null\n      };\n\n    case 'FETCH_BOOKS_FAILURE':\n      return { ...state,\n        books: [],\n        loading: false,\n        error: action.payload\n      };\n\n    case 'BOOK_ADDED_TO_CART':\n      const ID = action.payload; // clicked id\n\n      const currentBook = state.books.find(book => book.id === ID); // book from list\n\n      const isBookInCartIndex = state.cartItems.findIndex(book => book.id === ID); // >0 || -1\n\n      const bookInCart = state.cartItems[isBookInCartIndex]; // index || undefined\n\n      const data = updateCartItem(currentBook, bookInCart);\n      return { ...state,\n        cartItems: data,\n        orderTotal: updateOrderTotal(data)\n      };\n\n    case 'BOOKS_DELETED_FROM_CART':\n      const booksID = action.payload; // clicked id\n\n      const priceOfDeletedBooks = state.cartItems.find(({\n        id\n      }) => id === booksID).total;\n      const newCartList = state.cartItems.filter(({\n        id\n      }) => id !== booksID);\n      return { ...state,\n        cartItems: newCartList,\n        orderTotal: updateOrderTotal(newCartList)\n      };\n\n    case 'BOOK_DELETED_FROM_CART':\n      const bookID = action.payload; // clicked id\n\n      const newCarts = [...state.cartItems];\n      const deletedBooksGroup = newCarts.find(({\n        id\n      }) => id === bookID);\n      const getCount = deletedBooksGroup.count - 1;\n\n      if (getCount === 0) {\n        return { ...state,\n          cartItems: newCarts.filter(({\n            id\n          }) => id !== bookID)\n        };\n      }\n\n      const getTotal = deletedBooksGroup.total / deletedBooksGroup.count;\n      deletedBooksGroup.count = getCount;\n      deletedBooksGroup.total -= getTotal;\n      return { ...state,\n        cartItems: newCarts\n      };\n\n    default:\n      return state;\n  }\n};","map":{"version":3,"sources":["/home/user/Рабочий стол/redux-sandbox/src/reducers/index.js"],"names":["initialState","books","loading","error","cartItems","orderTotal","cartItemsTotal","updateCartItems","item","index","slice","updateCartItem","book","id","name","count","total","price","updateOrderTotal","console","log","Array","isArray","reduce","acc","el","updateCartItemsTotal","reducer","state","action","type","payload","ID","currentBook","find","isBookInCartIndex","findIndex","bookInCart","data","booksID","priceOfDeletedBooks","newCartList","filter","bookID","newCarts","deletedBooksGroup","getCount","getTotal"],"mappings":"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","sourcesContent":["const initialState = {\n    books: [],\n    loading: true,\n    error: null,\n    cartItems: [],\n    orderTotal: 0,\n    cartItemsTotal: 0\n}\n\nconst updateCartItems = (cartItems, item, index) => {\n    if (index === -1) {\n        return [\n            ...cartItems,\n            item\n        ]\n    }\n    return [\n        ...cartItems.slice(0, index),\n        item,\n        ...cartItems.slice(++index)\n    ]\n}\n\nconst updateCartItem = (book, item = {}) => {\n    const {id = book.id, name = book.name, count = 0, total = 0} = item\n    return {\n        id,\n        name,\n        count: count + 1,\n        total: book.price + total,\n    }\n}\n\nconst updateOrderTotal = (cartItems) => {\n    console.log(cartItems)\n    if(Array.isArray(cartItems)) return cartItems.reduce((acc, el) => acc + el.total, 0)\n    return 1\n}\n\nconst updateCartItemsTotal = (cartItems) => {\n    return cartItems.reduce((acc, el) => acc + el.count, 0)\n}\n\nexport const reducer = (state = initialState, action) => {\n\n    switch (action.type) {\n\n        case 'FETCH_BOOKS_SUCCESS' :\n            return {\n                ...state,\n                books: action.payload,\n                loading: false,\n                error: null\n            }\n\n        case 'FETCH_BOOKS_REQUEST' :\n            return {\n                ...state,\n                books: [],\n                loading: true,\n                error: null\n            }\n\n        case 'FETCH_BOOKS_FAILURE' :\n            return {\n                ...state,\n                books: [],\n                loading: false,\n                error: action.payload\n            }\n\n        case 'BOOK_ADDED_TO_CART' :\n            const ID = action.payload; // clicked id\n            const currentBook = state.books.find(book => book.id === ID) // book from list\n            const isBookInCartIndex = state.cartItems.findIndex(book => book.id === ID) // >0 || -1\n            const bookInCart = state.cartItems[isBookInCartIndex] // index || undefined\n            const data = updateCartItem(currentBook, bookInCart)\n            return {\n                ...state,\n                cartItems: data,\n                orderTotal: updateOrderTotal(data)\n            }\n\n        case 'BOOKS_DELETED_FROM_CART' :\n            const booksID = action.payload; // clicked id\n            const priceOfDeletedBooks = state.cartItems.find(({id}) => id === booksID).total;\n            const newCartList = state.cartItems.filter(({id}) => id !== booksID);\n            return {\n                ...state,\n                cartItems: newCartList,\n                orderTotal: updateOrderTotal(newCartList)\n            }\n\n        case 'BOOK_DELETED_FROM_CART' :\n            const bookID = action.payload; // clicked id\n            const newCarts = [...state.cartItems]\n            const deletedBooksGroup = newCarts.find(({id}) => id === bookID)\n            const getCount = deletedBooksGroup.count - 1\n            if (getCount === 0) {\n                return {\n                    ...state,\n                    cartItems: newCarts.filter(({id}) => id !== bookID)\n                }\n            }\n            const getTotal = deletedBooksGroup.total / deletedBooksGroup.count\n            deletedBooksGroup.count = getCount\n            deletedBooksGroup.total -= getTotal\n            return {\n                ...state,\n                cartItems: newCarts\n            }\n        default:\n            return state\n    }\n}"]},"metadata":{},"sourceType":"module"}